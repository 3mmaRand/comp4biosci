{
  "hash": "15a68b64298b42593262d4b9adfa793c",
  "result": {
    "engine": "knitr",
    "markdown": "# *Pseudomonas putida* grown in two soil types at two temperatures {#sec-26C-food-fuel-prac2}\n\n\n::: {.callout-important} \n## Incomplete\nYou are reading a live document. This page is a dumping ground for one or more ideas. Sections maybe missing, or in bullet form and code may not be explained.\n:::\n\n## Scenario\n\n*Pseudomonas putida*, is a hydrocarbon-degrading bacterium used for\ncleaning up oil-contaminated soil. *P.putida* was growth on either\nhexadecane contaminated or control soil at two temperatures: 4 degrees\nor 25 degrees. The was is to determine the effect of temperature and\nsoil type on the number of bacteria in the soil.\n\nEach group in a large class did one replicate and added their data to a\nGoogle sheet:\n<https://docs.google.com/spreadsheets/d/1k2Gq4tKGEI0v_tdfgI-1d-Lk4YaWAC50sHffOmnqESU/edit?gid=886771226#gid=886771226>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(googlesheets4)\nlibrary(tidyverse)\nlibrary(emmeans)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfile <- \"https://docs.google.com/spreadsheets/d/1k2Gq4tKGEI0v_tdfgI-1d-Lk4YaWAC50sHffOmnqESU/edit?gid=886771226#gid=886771226\"\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass_data <- read_sheet(file) |> janitor::clean_names()\n```\n:::\n\n\nYou will be asked to authenticate in your browser. This message will\nappear in the console and the browser should open\n\n```         \nWaiting for authentication in browser...\nPress Esc/Ctrl + C to abort\n```\n\nYou can Allow “Tidyverse API Packages wants to access your Google\nAccount”.\n\nYou might also be asked\n\n```         \nIs it OK to cache OAuth access credentials in the folder\n```\n\nChoose the option for yes\n\n```         \nThe httpuv package enables a nicer Google auth experience, in many cases, but it\nisn't installed.\nWould you like to install it now?\n```\n\nChoose the option for yes.\n\n\nThe data should then read in.\n\n::: callout-note\n\n## Next time you run `read_sheet()` from `googlesheets4`\n\nNext time you run `read_sheet()` from `googlesheets4` you will\nnot have to authenticate in your browser if you chose \"yes\" for\n`Is it OK to cache OAuth access credentials in the folder`.\n\nInstead you will see:\n```\nThe googlesheets4 package is requesting access to your Google account.\nEnter '1' to start a new auth process or select a pre-authorized account.\n1: Send me to the browser for a new auth process.\n2: your.email@whereever.ac.uk\n```\nYou can chose 2\n\n:::\n\nWe don't need the timestamp or group name columns and these can be \ndropped using the `select()` command\n\nThe data are in wide format - there is sample in column. We want to\nconvert to long format so that each row contains a single count\nand the other columns give the soil and the temperature treatment.\nWe can use `pivot_longer()` for this.\n\nDrooping the columns (`-`) and pivoting the data can be done in one\npipeline:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass_data <- class_data |> \n  select(-timestamp, -group_name) |>\n  pivot_longer(cols = everything(),\n               names_to = \"treatment\",\n               values_to = \"counts_cpg\") \n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\nclass_data <- class_data |>\n  extract(\n    col = treatment,\n    into = c(\"soil\", \"temp\"),\n    regex = \"^([uh]).([fi])_cells_gram_of_soil$\"\n  ) |>\n  mutate(\n    soil = recode(soil,\n                  \"u\" = \"uncontaminated\",\n                  \"h\" = \"hexadecane contaminated\"),\n    temp = recode(temp,\n                         \"f\" = \"4 degrees\",\n                         \"i\" = \"25 degrees\")\n  ) \n\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(class_data, \n       aes(x = soil, y = counts_cpg, fill = temp)) +\n  geom_boxplot() \n```\n\n::: {.cell-output-display}\n![](26C-food-fuel-prac2_files/figure-html/unnamed-chunk-7-1.png){width=576}\n:::\n:::\n\n\nThe data are not normally distributed - there are a few very large\nvalues. Logging the data will aid visualisation:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(class_data, \n       aes(x = soil, y = log10(counts_cpg), fill = temp)) +\n  geom_boxplot() \n```\n\n::: {.cell-output-display}\n![](26C-food-fuel-prac2_files/figure-html/unnamed-chunk-8-1.png){width=576}\n:::\n:::\n\n\nThat's better but the warning:\n`Removed 11 rows containing non-finite  outside the scale range`\nindicates that there are some zeros. We can add 1 to the counts before\nlogging to avoid this. This is a common practice. It is useful because\n`log(1) = 0` which simplifies interpretation and is better than removing\nthem. Many of the values are very large - the next smallest number is\n75 - and adding 1 to large values before logging will have very little\nimpact.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(class_data, \n       aes(x = soil, y = log10(counts_cpg + 1), fill = temp)) +\n  geom_boxplot() \n```\n\n::: {.cell-output-display}\n![](26C-food-fuel-prac2_files/figure-html/unnamed-chunk-9-1.png){width=576}\n:::\n:::\n\n\nTemperature seems to matter but there is little difference between the\ntwo soils. The difference between the two temperatures is about the same\nin both soils suggesting no interaction.\n\nAdd a new column to the data frame with the logged values that we can\nuse in the model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass_data <- class_data |> \n  mutate(log_counts = log10(counts_cpg + 1))\n```\n:::\n\n\nSummarise the data to get the means and se for each group.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass_data_summary <- class_data |> \n  group_by(soil, temp) |> \n  summarise(mean = mean(log_counts),\n            sd = sd(log_counts),\n            n = length(log_counts),\n            se = sd/sqrt(n)) \n```\n:::\n\n\ntwo-way anova\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- lm(data = class_data,\n          log_counts ~ soil * temp)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mod)\n## \n## Call:\n## lm(formula = log_counts ~ soil * temp, data = class_data)\n## \n## Residuals:\n##     Min      1Q  Median      3Q     Max \n## -7.5791 -0.3205  0.1573  0.6250  4.6301 \n## \n## Coefficients:\n##                                  Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)                        7.5791     0.1851  40.943   <2e-16 ***\n## soiluncontaminated                 0.0897     0.2618   0.343    0.732    \n## temp4 degrees                     -2.4686     0.2618  -9.430   <2e-16 ***\n## soiluncontaminated:temp4 degrees  -0.1270     0.3702  -0.343    0.732    \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 1.571 on 284 degrees of freedom\n## Multiple R-squared:  0.3973,\tAdjusted R-squared:  0.391 \n## F-statistic: 62.41 on 3 and 284 DF,  p-value: < 2.2e-16\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(mod)\n## Analysis of Variance Table\n## \n## Response: log_counts\n##            Df Sum Sq Mean Sq  F value Pr(>F)    \n## soil        1   0.05    0.05   0.0200 0.8876    \n## temp        1 461.62  461.62 187.1022 <2e-16 ***\n## soil:temp   1   0.29    0.29   0.1177 0.7318    \n## Residuals 284 700.69    2.47                    \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n\nThere is a strong and significant effect of temperature, no effect of\nsoil and no interaction between temperature and soil. The effect of\ntemperature is independent of soil.\n\nexamine the assumptions\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mapping = aes(x = mod$residuals)) +\n  geom_histogram(bins = 30) \n```\n\n::: {.cell-output-display}\n![](26C-food-fuel-prac2_files/figure-html/unnamed-chunk-15-1.png){width=576}\n:::\n:::\n\n\nToo may values in the middle, too few in the shoulders for a normal\ndistribution.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(mod$residuals)\n## \n## \tShapiro-Wilk normality test\n## \n## data:  mod$residuals\n## W = 0.83366, p-value < 2.2e-16\n```\n:::\n\n\nSignificantly different from a normal distribution.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(mod, which = 1)\n```\n\n::: {.cell-output-display}\n![](26C-food-fuel-prac2_files/figure-html/unnamed-chunk-17-1.png){width=576}\n:::\n:::\n\n\nVariances are similar in each group\n\nNot normal but reasonably symmetrical and variances are similar in each\ngroup. In addition, the effect is very clear - not at all borderline -\nso this case I will continue with the two-way anova.\n\nPost-hoc tests. Expecting differences between temps regardless of soil\ntype.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemmeans(mod, ~ soil * temp) |> pairs()\n##  contrast                                                              \n##  hexadecane contaminated 25 degrees - uncontaminated 25 degrees        \n##  hexadecane contaminated 25 degrees - hexadecane contaminated 4 degrees\n##  hexadecane contaminated 25 degrees - uncontaminated 4 degrees         \n##  uncontaminated 25 degrees - hexadecane contaminated 4 degrees         \n##  uncontaminated 25 degrees - uncontaminated 4 degrees                  \n##  hexadecane contaminated 4 degrees - uncontaminated 4 degrees          \n##  estimate    SE  df t.ratio p.value\n##   -0.0897 0.262 284  -0.343  0.9861\n##    2.4686 0.262 284   9.430  <.0001\n##    2.5059 0.262 284   9.572  <.0001\n##    2.5583 0.262 284   9.772  <.0001\n##    2.5956 0.262 284   9.915  <.0001\n##    0.0373 0.262 284   0.143  0.9990\n## \n## P value adjustment: tukey method for comparing a family of 4 estimates\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\nggplot() + \n  geom_point(data = class_data, \n             aes(x = soil, y = log_counts, shape = temp), \n             position = position_jitterdodge(dodge.width = 1,\n                                             jitter.width = 0.3, \n                                             jitter.height = 0), \n             size = 3, \n             colour = \"gray50\") +\n  geom_errorbar(data = class_data_summary, \n                aes(x = soil, ymin = mean - se,\n                    ymax = mean + se, group = temp), \n                width = 0.5, \n                linewidth = 1, \n                position = position_dodge(width = 1)) + \n  geom_errorbar(data = class_data_summary,\n                aes(x = soil, ymin = mean, ymax = mean, group = temp), \n                width = 0.4, \n                linewidth = 1, \n                position = position_dodge(width = 1) ) +\n  scale_x_discrete(name = \"soil\", expand = c(0, 0)) +\n  scale_y_continuous(name = \"Log Counts\", expand = c(0, 0),                                                                                                              limits = c(0, 14)) +\n  scale_shape_manual(values = c(19, 1), \n                     name = \"Temperature\") +\n  # hexadecane contaminated 25 degrees - \n  # hexadecane contaminated 4 degrees <.0001 \n  annotate(\"segment\", \n           x = 0.75, xend = 1.25,\n           y = 11.7, yend = 11.7, \n           colour = \"black\") +\n  annotate(\"text\", x = 1, y = 12, \n           label = \"p < 0.0001\") +\n  # uncontaminated 25 degrees - \n  # uncontaminated 4 degrees <.0001 \n  annotate(\"segment\", \n           x = 1.75, xend = 2.25, \n           y = 11.7, yend = 11.7, \n           colour = \"black\") +\n  annotate(\"text\", x = 2, y = 12, \n           label = \"p < 0.0001\") +\n  # hexadecane contaminated 25 degrees -\n  # uncontaminated 4 degrees <.0001 \n  annotate(\"segment\", \n           x = 0.75, xend = 2.25, \n           y = 12.7, yend = 12.7, \n           colour = \"black\") +\n  annotate(\"text\", x = 1.5, y = 13, \n           label = \"p < 0.0001\") +\n  # uncontaminated 25 degrees - \n  # hexadecane contaminated 4 degrees <.0001 \n  annotate(\"segment\", \n           x = 1.25, xend = 1.75, \n           y = 10.7, yend = 10.7, \n           colour = \"black\") +\n  annotate(\"text\",\n           x = 1.5, y = 11, \n           label = \"p < 0.0001\") +\n  theme_classic() +\n  theme(legend.position = \"inside\",\n        legend.position.inside = c(0.92, 0.9),\n        legend.background = element_rect(colour = \"black\"))\n```\n\n::: {.cell-output-display}\n![](26C-food-fuel-prac2_files/figure-html/unnamed-chunk-19-1.png){width=576}\n:::\n:::\n\n\n",
    "supporting": [
      "26C-food-fuel-prac2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}