{
  "hash": "1d66ce6a91f1e4a497a93a8b71e932cf",
  "result": {
    "engine": "knitr",
    "markdown": "# Confidence Intervals\n\n\n\n\n\n::: {.callout-warning} \n## First draft\nYou are reading a work in progress. This page is a first draft but should be readable.\n:::\n\n\n\n\n## What is a confidence interval?\n\nWhen we calculate a mean from a sample, we are using it to estimate the\nmean of the population. Confidence intervals are a range of values and\nare a way to quantify the uncertainty in our estimate. When we report a\nmean with its 95% confidence interval we give the mean plus and minus\nsome variation. We are saying that 95% of the time, that range will\ncontain the population mean.\n\nThe confidence interval is calculated from the sample mean and the\nstandard error of the mean. The standard error of the mean is the\nstandard deviation of the [sampling distribution of the\nmean](logic_hyopthesis_testing.html#sampling-distribution-of-the-mean).\n\nTo understand confidence intervals we need to understand some properties\nof the normal distribution.\n\n## The normal distribution\n\nA [distribution](ideas_about_data.html#distributions) describes the\n*values* the variable can take and the *chance* of them occurring. A\ndistribution has a general type, given by the function, and is further\ntuned by the *parameters* in the function. For the normal distribution\nthese parameters are the mean and the standard deviation. Every variable\nthat follows the normal distribution has the same bell shaped curve and\nthe distributions differ only in their means and/or standard deviations.\nThe mean determines where the centre of the distribution is, the\nstandard deviation determines the spread (@fig-normal-distributions).\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![The mean determines where the centre of the distribution is, the standard deviation determines the spread. The distributions on the left have the same mean but different standard deviations. The distributions on the right have the same standard deviation but different means.](confidence_intervals_files/figure-html/fig-normal-distributions-1.png){#fig-normal-distributions width=576}\n:::\n:::\n\n\n\n\nWhilst normal distributions vary in the location on the horizontal axis\nand their width, they all share some properties and it is these shared\nproperties that allow the calculation of confidence intervals with some\nstandard formulae. The properties are that a fix percentage of values\nlie between a given number of standard deviations. For example, 68.2%\nvalues lie between plus and minus one standard deviation from the mean\nand 95% values lie between $\\pm$ 1.96 standard deviations. Another way\nof saying this is that there is a 95% chance that a randomly selected\nvalue will lie between $\\pm$ 1.96 standard deviations from the mean.\nThis is illustrated in @fig-norm-dist-means-properties.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Normal distributions share some properties regardless of the mean and standard deviation. 68% of the values are within 1 standard deviation of the mean and 95% are within 1.96 standard deviations.](confidence_intervals_files/figure-html/fig-norm-dist-means-properties-1.png){#fig-norm-dist-means-properties width=576}\n:::\n:::\n\n\n\n\nR has some useful functions associated with distributions, including the\nnormal distribution.\n\n### Distributions: the R functions\n\nFor any distribution, R has four functions:\n\n-   the density function, which gives the height of the function at a\n    given value.\n-   the distribution function, which gives the **probability** that a\n    variable takes a particular value or less.\n-   the quantile function which is the inverse of the Distribution\n    function, *i.e.*, it returns the value ('quantile') for a given\n    probability.\n-   the random number generating function\n\nThe functions are named with a letter `d`, `p`, `q` or `r` preceding the\ndistribution name. @tbl-rdistrib shows these four functions for the\nnormal, binomial, Poisson and t distributions.\n\n| Distribution | Density    | Distribution | Quantile   | Random number generating |\n|---------------|---------------|---------------|---------------|---------------|\n| Normal       | `dnorm()`  | `pnorm()`    | `qnorm()`  | `rnorm()`                |\n| Binomial     | `dbinom()` | `pbinom()`   | `qbinom()` | `rbinom()`               |\n| Poisson      | `dpois()`  | `ppois()`    | `qpois()`  | `rpois()`                |\n| t            | `dt()`     | `pt()`       | `qt()`     | `rt()`                   |\n\n: R functions that provide values for some example distributions\n{#tbl-rdistrib}\n\nSearching for the manual with `?normal` or any one of the functions\n(`?pnorm`) will bring up a single help page for all four associated\nfunctions.\n\n::: {#fig-manual-page}\n<iframe style=\"height:400px;width:750px;border:2px\" src=\"https://stat.ethz.ch/R-manual/R-devel/library/stats/html/Normal.html\" title=\"Manual page\">\n\n</iframe>\n\nThe R Manual Page for the normal distribution which shows the four\nfunctions associated functions.\n:::\n\nThe functions which are of most use to us are `pnorm()` and `qnorm()`\nand these are illustrated in @fig-pnorm.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![The `pnorm()` function calculates the probability that a value is less than or equal to a given value.](confidence_intervals_files/figure-html/fig-pnorm-1.png){#fig-pnorm width=576}\n:::\n:::\n\n\n\n\n## Confidence intervals on large samples\n\n$$\n\\bar{x} \\pm 1.96 \\times s.e.\n$$ {#eq-ci-large-sample}\n\n95% of confidence intervals calculated in this way will contain the true\npopulation mean.\n\nDo you have to remember the value of 1.96? Not if you have R!\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqnorm(0.975)\n## [1] 1.959964\n```\n:::\n\n\n\n\nNotice that it is `qnorm(0.975)` and not `qnorm(0.95)` for a 95%\nconfidence interval. This is because the functions are defined as giving\nthe area under to the curve to the left of the value given. If we gave\n0.95, we would get the value that put 0.05 in one tail. We want 0.025 in\neach tail, so we need to use 0.975 in `qnorm()`.\n\nTO-DO pic\n\n## Confidence intervals on small samples\n\nThe calculation of confidence intervals on small samples is very similar\nbut we use the *t*-distribution rather than the normal distribution. The\nformula is:\n\n$$\n\\bar{x} \\pm t_{[d.f.]} \\times s.e.\n$$ {#eq-ci-small-sample}\n\nThe *t*-distibution is a modified version of the normal distribution and\nwe use it because the sampling distribution of the mean is not quite\nnormal when the sample size is small. The *t*-distribution has an\nadditional parameter called the *degrees of freedom* which is the sample\nsize minus one ($n -1$). Like the normal distribution, the\n*t*-distribution has a mean of zero and is symmetrical. However, The\n*t*-distribution has fatter tails than the normal distribution and this\nmeans that the probability of getting a value in the tails is higher\nthan for the normal distribution. The degrees of freedom determine how\nmuch fatter the tails are. The smaller the sample size, the fatter the\ntails. As the sample size increases, the *t*-distribution becomes more\nand more like the normal distribution.\n\n### What are degrees of freedom?\n\nDegrees of freedom (usually abbreivated *d.f.*) describe how much \nindependent information is available to estimate variability when \ncalculating probabilities. In a population, *all* values are known, \nso no parameters need estimating. In a sample, we estimate parameters \nsuch as the mean. In estimating a mean, only $n - 1$ values can vary\nindependently because one value is constrained by the sample mean. \nIn hypothesis tests and confidence intervals, *d.f.* adjust for \nuncertainty when generalizing from a sample to a population, affecting \nprobability distributions like the *t*-distribution. More *d.f.* mean \nbetter probability estimates, while fewer *d.f.* reflect greater \nuncertainty in estimating population parameters.\n\n\n## ðŸŽ¬ Your turn!\n\nIf you want to code along you will need to start a new [RStudio\nproject](workflow_rstudio.html#rstudio-projects), add a `data-raw`\nfolder and open a new script. You will also need to load the\n**`tidyverse`** package [@tidyverse].\n\n## Large samples\n\nA team of biomedical researchers is studying the concentration of\nCreatine Kinase (CK) in the blood of patients with muscle disorders.\nThey collect a large random sample (n = 100) of blood samples from\npatients and measure the CK concentration in UL^-1^ (units per litre).\n\nThe goal is to estimate the average CK concentration in this patient\npopulation and calculate a 95% confidence interval for the mean\nconcentration. The data are in [ck_concen.csv](data-raw/ck_concen.csv) \n\n### Import\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncreatinekinase <- read_csv(\"data-raw/ck_concen.csv\")\n```\n:::\n\n\n\n\n### Calculate sample statistics\n\nCalculate the mean, standard deviation, sample size and standard error\nand assign as variables:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# mean\nm <- mean(creatinekinase$ck_conc)\n\n# standard deviation\nsd <- sd(creatinekinase$ck_conc)\n\n# sample size (needed for the se)\nn <- length(creatinekinase$ck_conc)\n\n# standard error\nse <- sd / sqrt(n)\n```\n:::\n\n\n\n\n### Calcuate *C.I.*\n\nTo calculate the 95% confidence interval we need to look up the quantile\n(multiplier) using `qnorm()`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nq <- qnorm(0.975)\n```\n:::\n\n\n\n\nNow we can use it in our confidence interval calculation:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlcl <- m - q * se\nucl <- m + q * se\n```\n:::\n\n\n\n\nI used the names `lcl` and `ucl` to stand for \"lower confidence limit\"\nand \"upper confidence limit\" respectively.\n\nPrint the values:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlcl\n## [1] 284.3891\nucl\n## [1] 319.9483\n```\n:::\n\n\n\n\nThis means we are 95% confident the population mean lies between\n284.39 UL^-1^ and 319.95 UL^-1^. The amount we have\nadded/subtracted from the mean (`q * se`) is 17.78 thus\nwe sometimes see this written as 302.17 $\\pm$\n17.78 mm.\n\n### Report\n\nThe mean creatine kinase concentration in patients with muscle disorders\nis 302.17 UL^-1^, 95% C.I. \\[284.39,\n319.95\\]\n\n## Small samples\n\n\n## Summary of Confidence Intervals\n\n1.  A confidence interval gives a range of plausible values for a \n    population mean from a sample and is calculated from a sample\n    mean and standard error. \n\n2.  They are possible because all normal distributions have the same\n    properties. \n\n3.  95% Confidence Intervals for Large Samples:\n\n    -   Formula:\\\n        $$\n        \\bar{x} \\pm 1.96 \\times s.e.\n        $$\n    -   95% of confidence intervals computed this way will contain the\n        true population mean.\n\n4.  95% Confidence Intervals for Small Samples:\n\n    -   Uses the *t*-distribution instead of the normal distribution.\\\n    -   Formula:\\\n        $$\n        \\bar{x} \\pm t_{[d.f.]} \\times s.e.\n        $$\n    -   The *t*-distribution has fatter tails and varies based on\n        degrees of freedom (*n-1*), approaching the normal distribution\n        as *n* increases.\n\n",
    "supporting": [
      "confidence_intervals_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}