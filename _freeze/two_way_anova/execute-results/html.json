{
  "hash": "4bad12bba17eba9d118ee0ae1692f698",
  "result": {
    "engine": "knitr",
    "markdown": "# Two-way ANOVA\n\n\n\n\n\n::: {.callout-tip} \n## Just needs proof reading\nYou are reading a work in progress. This page is compete but needs final proof reading.\n:::\n\n\n\n\n## Overview\n\nIn the last chapter, we learnt how to use and interpret the general\nlinear model when the *x* variable was categorical with two or more\ngroups. This procedure is known as one-way ANOVA. We will now\nincorporate a *second* categorical variable. This is often known as the\ntwo-way or two-factor ANOVA (**an**alysis **o**f **var**iance). It might\nalso be described as a \"factorial design\".\n\nIn the last chapter we conducted a one-way ANOVA to test whether there\nwas an of media on the diameter of bacterial colonies. Suppose we had\nrun this experiment on more than one bacterial species. We would then\nhave two explanatory variables: media and species. Perhaps we should do\ntwo one-way ANOVAs, one for each explanatory variable? This would tell\nus whether each explanatory variable had an effect on the response\nvariable. However, it would not tell us whether there was an\n**interaction** between the two variables. An interaction is when the\neffect of one variable depends on the level of another and in some ways\nit is the most interesting result we could reveal. For example, we might\nfind that the optimal media for one species was not the optimal media\nfor the other species. A two-way ANOVA allows us to test for the effects\nof each explanatory variable *and* whether they interact. A two-way\nANOVA has three null hypotheses:\n\n1.  There is no effect of media on diameter, or there is no difference\n    between the mean diameter of colonies grown on different media.\n2.  There is no effect of species on diameter, or there is no difference\n    between bacteria in colony diameter.\n3.  The effect of media is the same for all species, or the effect of\n    media does not depend on species.\n\nAs a General linear model, two-way ANOVA is a parametric test with\nassumptions based on the normal distribution which need to be met for\nthe *p*-values generated to be accurate. We use `lm()` to fit the model,\n`anova()` to test the significance of the explanatory variables and\n`emmeans()` and pairs() for post-hoc testing.\n\n### Model assumptions\n\nWe examine the model assumptions in the same way as we did for single\nlinear regression, two-sample tests and one-way ANOVA: we apply the\ngeneral linear model with `lm()` and *then* check the assumptions using\ndiagnostic plots and the Shapiro-Wilk normality test. We also use common\nsense:\n\n-   the response should be continuous (or nearly continuous, see [Ideas\n    about data: Theory and\n    practice](ideas_about_data.html#theory-and-practice)) and we\n    consider whether we would expect the response to be normally\n    distributed.\n-   we expect decimal places and few repeated values.\n\n### Reporting\n\nIn reporting the result of two-way ANOVA, we include:\n\n1.  the significance of each of the explanatory variables and the\n    interaction between them.\n\n    -   The *F*-statistic and *p*-value for each explanatory variable\n        and the interaction term.\n\n2.  the direction of effect - which of the means is greater\n\n    -   Post-hoc test\n\n3.  the magnitude of effect - how big is the difference between the\n    means\n\n    -   the means and standard errors for each group\n\nFigures should reflect what you have said in the statements. Ideally\nthey should show both the raw data and the statistical model: means and\nstandard errors\n\n### When the assumptions are not met\n\n#### When residuals are not normally distributed\n\nThere are a few options for dealing with non-normally distributed\nresiduals when you wanted to do a two-way ANOVA. Transforming your data\nmight help - but it depends on how the data are not normal - if there\nare lots of values the same for example, no transformation helps! If the\ndata have positive skew (tail in the positive direction) then logging\ncan help.\n\n#### When residuals are not normally distributed and/or variance is unequal\n\nThere are some rank-based tests, such as the Friedman test and the \nScheirer-Ray-Hare test, that apply to specific situations. However, \nthere is no non-parametric alternative that directly corresponds to \ntwo-way ANOVA in the same way that the Kruskal-Wallis test does for \none-way ANOVA.\n\nIn these cases you have other good options.\n\n1.  **Use two-way ANOVA carefully**. Using the two-way ANOVA test \n    and interpreting the results with caution is one valid approach. \n    ANOVA is actually quite robust to violating the normality assumption\n    (it performs quite well anyway) depending on how much the residuals \n    deviate.\n    \n2.  **Using non-parametric one-way tests**. Divide the dataset according\n    to the groups in one factor, then carry out a Wilcoxon rank-sum test\n    (also known as the Mann-Whitney test) or a Kruskal-Wallis test on\n    each subset for the other factor. For example, if the two factors\n    are Fertilizer Type (Organic, Chemical, Control) and Soil Moisture\n    (Low, Medium, High), split the dataset by Fertilizer Type. Within\n    each subset, perform a Wilcoxon rank-sum test if the second factor\n    has two levels or a Kruskal-Wallis test if it has more than two\n    levels to determine whether the second factor affects the response\n    variable. While there is no direct test for an interaction, you can\n    infer one. If the results are consistent across all subsets, meaning\n    the second factor has the same effect regardless of the first\n    factor, there is no evidence of an interaction. However, if the\n    effect of the second factor varies between subsets, this suggests an\n    interaction, as the influence of one factor depends on the level of\n    the other.\n\n<!-- 2.  **Using a Permutation Test**. A permutation test checks if an  -->\n<!--     observed difference is real or just due to chance by shuffling  -->\n<!--     the data many times and seeing how often a difference as big as  -->\n<!--     the original one appears. Instead of using formulas based on  -->\n<!--     assumptions, it creates a null distribution from the shuffled  -->\n<!--     data and calculates a p-value based on how rare the observed  -->\n<!--     result is. This makes it useful when normal statistical methods  -->\n<!--     don’t apply. -->\n\n\n\nWe will explore all of these ideas with some examples.\n\n## 🎬 Your turn!\n\nIf you want to code along you will need to start a new [RStudio\nproject](workflow_rstudio.html#rstudio-projects), add a `data-raw`\nfolder and open a new script. You will also need to load the\n**`tidyverse`** package [@tidyverse].\n\n## Two-way ANOVA\n\nResearchers have collected live specimens of two species of periwinkle\n(See @fig-periwinkles) from sites in northern England in the Spring and\nSummer. They took a measure of the gut parasite load by examining a\nslide of gut contents. The data are in\n[periwinkle.txt](data-raw/periwinkle.txt). The data were collected to\ndetermine whether there was an effect of season or species on parasite\nload and whether these effects were independent.\n\n![Periwinkles are marine gastropod molluscs (slugs and snails). A)\n*Littorina brevicula* (PD files - Public Domain,\nhttps://commons.wikimedia.org/w/index.php?curid=30577419) B) *Littorina\nlittorea*. (photographed by Guttorm Flatabø (user:dittaeva). -\nPhotograph taken with an Olympus Camedia C-70 Zoom digital camera.\nMetainformation edited with Irfanview, possibly cropped with jpegcrop.,\nCC BY-SA 3.0,\nhttps://commons.wikimedia.org/w/index.php?curid=324769](images/Littorina.jpg){#fig-periwinkles\nfig-alt=\"\"}\n\n### Import and explore\n\nImport the data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperiwinkle <- read_delim(\"data-raw/periwinkle.txt\", delim = \"\\t\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; \"><table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> para </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> season </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> species </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 58.86 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51.73 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 54.99 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 39.84 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 65.05 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 67.46 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 60.38 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 54.42 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 47.71 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 66.87 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51.02 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 43.95 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 62.40 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 55.67 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 58.45 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 43.52 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 69.29 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 71.22 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 64.60 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 58.53 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51.15 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 70.62 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 55.10 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 47.00 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 54.48 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 43.52 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 63.26 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 58.76 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 61.38 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 63.70 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 45.69 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 45.20 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 77.23 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 57.12 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 49.32 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 72.92 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 47.95 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 78.70 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 77.01 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 71.70 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 69.36 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 66.46 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 76.35 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 75.55 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 54.59 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 62.02 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 58.50 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 76.09 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 68.85 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 84.55 </td>\n   <td style=\"text-align:left;\"> Spring </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 61.60 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 70.84 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 68.89 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 67.68 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 88.68 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 64.64 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 69.71 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 70.65 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 56.85 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 80.06 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 80.93 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 53.62 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 56.77 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 101.81 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 81.65 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 88.73 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 67.50 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 73.75 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 75.80 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 74.70 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 68.26 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 89.29 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 75.09 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 74.99 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 76.03 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina brevicula </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 66.67 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 61.31 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51.00 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 67.43 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 78.12 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 79.26 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 69.03 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 76.14 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 86.81 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 97.56 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 64.64 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 68.64 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 65.95 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 49.50 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 62.22 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 57.34 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 70.30 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 62.75 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 80.48 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 81.74 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 85.83 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 77.51 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 61.12 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 59.83 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 66.52 </td>\n   <td style=\"text-align:left;\"> Summer </td>\n   <td style=\"text-align:left;\"> Littorina littorea </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n\n\n\nThe Response variable is parasite load and it appears to be continuous.\nThe Explanatory variables are species and season and each has two\nlevels. It is known “two-way ANOVA” or “two-factor ANOVA” because there\nare two explanatory variables.\n\nThese data are in tidy format [@Wickham2014-nl] - all the parasite load\nvalues are in one column (`para`) with the other columns indicating the\n`species` and the `season`. This means they are well formatted for\nanalysis and plotting.\n\nIn the first instance it is sensible to create a rough plot of our data.\nThis is to give us an overview and help identify if there are any issues\nlike missing or extreme values. It also gives us idea what we are\nexpecting from the analysis which will make it easier for us to identify\nif we make some mistake in applying that analysis.\n\nViolin plots (`geom_violin()`, see @fig-periwinkle-rough), box plots\n(`geom_boxplot()`) or scatter plots (`geom_point()`) all make good\nchoices for exploratory plotting and it does not matter which of these\nyou choose.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = periwinkle, \n       aes(x = season, y = para, fill = species)) +\n  geom_violin()\n```\n\n::: {.cell-output-display}\n![The parasite load for two species of Littorina indicated by the fill colour, in the Spring and Summer. Parasite load seems to be higher for both species in the summer and that effect looks bigger in L.brevicula - it has the lowest spring mean but the highest summer mean.](two_way_anova_files/figure-html/fig-periwinkle-rough-1.png){#fig-periwinkle-rough width=576}\n:::\n:::\n\n\n\n\nR will order the groups alphabetically by default.\n\nThe figure suggests that parasite load is higher for both species in the\nsummer and that effect looks bigger in *L.brevicula* - it has the lowest\nspring mean but the highest summer mean.\n\nSummarising the data for each species-season combination is the next\nsensible step. The most useful summary statistics are the means,\nstandard deviations, sample sizes and standard errors. I recommend the\n`group_by()` and `summarise()` approach:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperi_summary <- periwinkle |>  \n  group_by(season, species) |>  \n  summarise(mean = mean(para),\n            sd = sd(para),\n            n = length(para),\n            se = sd / sqrt(n))\n```\n:::\n\n\n\n\nWe have save the results to `peri_summary` so that we can use the means\nand standard errors in our plot later.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperi_summary\n## # A tibble: 4 × 6\n## # Groups:   season [2]\n##   season species              mean    sd     n    se\n##   <chr>  <chr>               <dbl> <dbl> <int> <dbl>\n## 1 Spring Littorina brevicula  57.0  8.83    25  1.77\n## 2 Spring Littorina littorea   64.2 11.9     25  2.38\n## 3 Summer Littorina brevicula  73.5 11.2     25  2.24\n## 4 Summer Littorina littorea   69.9 11.5     25  2.30\n```\n:::\n\n\n\n\nThe summary confirms both species have a higher mean in the summer and\nthat the difference between the species is reversed - *L.brevicula*\nminus *L.littorea* is -7.2588 in\nthe spring but 3.6328 in summer.\n\n### Apply `lm()`\n\nWe can create a two-way ANOVA model like this:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- lm(data = periwinkle, para ~ species * season)\n```\n:::\n\n\n\n\nAnd examine the model with:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mod)\n## \n## Call:\n## lm(formula = para ~ species * season, data = periwinkle)\n## \n## Residuals:\n##     Min      1Q  Median      3Q     Max \n## -20.711  -6.308  -1.120   8.085  28.269 \n## \n## Coefficients:\n##                                        Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)                              56.972      2.185  26.073  < 2e-16 ***\n## speciesLittorina littorea                 7.259      3.090   2.349   0.0209 *  \n## seasonSummer                             16.568      3.090   5.362 5.68e-07 ***\n## speciesLittorina littorea:seasonSummer  -10.892      4.370  -2.492   0.0144 *  \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 10.93 on 96 degrees of freedom\n## Multiple R-squared:  0.2547,\tAdjusted R-squared:  0.2314 \n## F-statistic: 10.94 on 3 and 96 DF,  p-value: 3.043e-06\n```\n:::\n\n\n\n\nThe Estimates in the Coefficients table give:\n\n-   `(Intercept)` known as $\\beta_0$. This the mean of the group with\n    the first level of *both* explanatory variables, *i.e.*, the mean of\n    *L.brevicula* group in Spring. Just as the intercept is the value of\n    *y* (the response) when the value of *x* (the explanatory) is zero\n    in a simple linear regression, this is the value of `para` when both\n    `season` and `species` are at their first levels. The order of the\n    levels is alphabetical by default.\n\n-   `speciesLittorina littorea` known as $\\beta_1$. This is what needs\n    to be added to the *L.brevicula* Spring mean (the intercept) when\n    the `species` goes from its first level to its second. That is, it\n    is the difference between the *L.brevicula* and *L.littorea* means\n    in Spring. The `speciesLittorina littorea` estimate is positive so\n    the the *L.littorea* mean is higher than the *L.brevicula* mean in\n    Spring. If we had more species we would have more estimates\n    beginning `species...` and all would be comparisons to the\n    intercept.\n\n-   `seasonSummer` known as $\\beta_2$. This is what needs to be added to\n    the *L.brevicula* Spring mean (the intercept) when the `season` goes\n    from its first level to its second. That is, it is the difference\n    between the Spring and Summer means for *L.brevicula*. The\n    `seasonSummer` estimate is positive so the the Summer mean is higher\n    than the Spring mean. If we had more seasons we would have more\n    estimates beginning `season...` and all would be comparisons to the\n    intercept.\n\n-   `speciesLittorina littorea:seasonSummer` known as $\\beta_3$. This is\n    interaction effect. It is an additional effect. Going from\n    *L.brevicula* to *L.littorea* adds $\\beta_1$ to the intercept. Going\n    from Spring to Summer adds $\\beta_2$ to the intercept. Going from\n    *L.brevicula* in Spring to *L.littorea* in Summer adds\n    $\\beta_1 + \\beta_2 + \\beta_3$ to the intercept. If $\\beta_3$ is zero\n    then the effect of `species` is the same in both `season`s. If\n    $\\beta_3$ is not zero then the effect of `species` is different in\n    the two `season`s.\n\nThe *p*-values on each line are tests of whether that coefficient is\ndifferent from zero.\n\nThe *F* value and *p*-value in the last line are a test of whether the\nmodel as a whole explains a significant amount of variation in the\nresponse variable. The model of season and species overall explains a\nsignificant amount of the variation in parasite load\n(`p-value: 3.043e-06`). To see which of the three effects are\nsignificant we can use the `anova()` function on our model.\n\nDetermine which effects are significant:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(mod)\n## Analysis of Variance Table\n## \n## Response: para\n##                Df  Sum Sq Mean Sq F value    Pr(>F)    \n## species         1    82.2   82.17  0.6884   0.40876    \n## season          1  3092.8 3092.81 25.9108 1.778e-06 ***\n## species:season  1   741.4  741.42  6.2114   0.01441 *  \n## Residuals      96 11458.9  119.36                      \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n\n\n\nThe parasite load is significantly greater in Summer (*F* = 25.9; *d.f.*\n= 1, 96; *p* \\< 0.0001) but this effect differs between species (*F* =\n6.2; *d.f.* = 1,96; *p* = 0.014) with a greater increase in parasite\nload in *L.brevicula* than in *L.littorea*.\n\nWe need a post-hoc test to see which comparisons are significant and can\nagain use then **`emmeans`** [@emmeans] package.\n\nLoad the package\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(emmeans)\n```\n:::\n\n\n\n\nCarry out the post-hoc test\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemmeans(mod, ~ species * season) |> pairs()\n##  contrast                                                estimate   SE df\n##  Littorina brevicula Spring - Littorina littorea Spring     -7.26 3.09 96\n##  Littorina brevicula Spring - Littorina brevicula Summer   -16.57 3.09 96\n##  Littorina brevicula Spring - Littorina littorea Summer    -12.94 3.09 96\n##  Littorina littorea Spring - Littorina brevicula Summer     -9.31 3.09 96\n##  Littorina littorea Spring - Littorina littorea Summer      -5.68 3.09 96\n##  Littorina brevicula Summer - Littorina littorea Summer      3.63 3.09 96\n##  t.ratio p.value\n##   -2.349  0.0943\n##   -5.362  <.0001\n##   -4.186  0.0004\n##   -3.013  0.0172\n##   -1.837  0.2625\n##    1.176  0.6436\n## \n## P value adjustment: tukey method for comparing a family of 4 estimates\n```\n:::\n\n\n\n\nEach row is a comparison between the two means in the 'contrast' column.\nThe 'estimate' column is the difference between those means and the\n'p.value' indicates whether that difference is significant.\n\nA plot can be used to visualise the result of the post hoc which can be\nespecially useful when there are very many comparisons.\n\nPlot the results of the post-hoc test:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemmeans(mod, ~ species * season) |> plot()\n```\n\n::: {.cell-output-display}\n![](two_way_anova_files/figure-html/unnamed-chunk-12-1.png){width=576}\n:::\n:::\n\n\n\n\nWe have significant differences between:\n\n-   *L.brevicula* in the Spring and Summer `p <.0001`\n-   *L.brevicula* in the Spring and *L.littorea* in the Summer\n    `p = 0.0004`\n-   *L.littorea* in the Spring *L.brevicula* in the Summer `p = 0.0172`\n\n### Check assumptions\n\nCheck the assumptions: All general linear models assume the \"residuals\"\nare normally distributed and have \"homogeneity\" of variance.\n\nOur first check of these assumptions is to use common sense: diameter is\na continuous and we would expect it to be normally distributed thus we\nwould expect the residuals to be normally distributed thus we would\nexpect the residuals to be normally distributed\n\nWe then proceed by plotting residuals. The `plot()` function can be used\nto plot the residuals against the fitted values (See @fig-anova2-plot1).\nThis is a good way to check for homogeneity of variance.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(mod, which = 1)\n```\n\n::: {.cell-output-display}\n![A plot of the residuals against the fitted values shows whether the points are distributed similarly in each group. Any difference seems small but perhaps the residuals are less variable for the lowest mean.](two_way_anova_files/figure-html/fig-anova2-plot1-1.png){#fig-anova2-plot1 width=576}\n:::\n:::\n\n\n\n\nWe can also use a histogram to check for normality (See\n@fig-anova2-plot2).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mapping = aes(x = mod$residuals)) + \n  geom_histogram(bins = 10)\n```\n\n::: {.cell-output-display}\n![A histogram of residuals is symetrical and seems consistent with a normal distribution. This is a good sign for the assumption of normally distributed residuals.](two_way_anova_files/figure-html/fig-anova2-plot2-1.png){#fig-anova2-plot2 width=576}\n:::\n:::\n\n\n\n\nFinally, we can use the Shapiro-Wilk test to test for normality.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(mod$residuals)\n## \n## \tShapiro-Wilk normality test\n## \n## data:  mod$residuals\n## W = 0.98424, p-value = 0.2798\n```\n:::\n\n\n\n\nThe p-value is greater than 0.05 so this test of the normality\nassumption is not significant.\n\nTaken together, these results suggest that the assumptions of normality\nand homogeneity of variance are probably not violated.\n\n### Report\n\nWe might report this result as:\n\nThe parasite load was significantly greater in Summer (*F* = 25.9;\n*d.f.* = 1, 96; *p* \\< 0.0001) but this effect differed between species\n(*F* = 6.2; *d.f.* = 1,96; *p* = 0.014) with a greater increase in\nparasite load in *L.brevicula* (from $\\bar{x} \\pm s.e$: 57.0 $\\pm$ 1.77\nunits to 73.5 $\\pm$ 2.24 units) than in *L.littorea* (from 64.2 $\\pm$\n2.38 units to 69.9 $\\pm$ 2.30 units). See @fig-para.\n\n::: {#fig-para}\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nggplot() +\n  geom_point(data = periwinkle, aes(x = season,\n                                    y = para,\n                                    shape = species),\n             position = position_jitterdodge(dodge.width = 1,\n                                             jitter.width = 0.3,\n                                             jitter.height = 0),\n             size = 3,\n             colour = \"gray50\") +\n  geom_errorbar(data = peri_summary, \n                aes(x = season, ymin = mean - se, ymax = mean + se, group = species),\n                width = 0.5,\n                linewidth = 1,\n                position = position_dodge(width = 1)) +\n  geom_errorbar(data = peri_summary, \n                aes(x = season, ymin = mean, ymax = mean, group = species),\n                width = 0.4,\n                linewidth = 1,\n                position = position_dodge(width = 1) ) +\n  scale_x_discrete(name = \"Season\") +\n  scale_y_continuous(name = \"Number of parasites\",\n                     expand = c(0, 0),\n                     limits = c(0, 140)) +\n  scale_shape_manual(values = c(19, 1),\n                     name = NULL,\n                     labels = c(bquote(italic(\"L.brevicula\")),\n                                bquote(italic(\"L.littorea\")))) +\n  # *L.brevicula* in the Spring and Summer `p <0.0001`\n  annotate(\"segment\",\n           x = 0.75, xend = 1.75,\n           y = 115, yend = 115,\n           colour = \"black\") +\n  annotate(\"text\",\n           x = 1.25,  y = 119,\n           label = \"p < 0.0001\") +\n  # # *L.brevicula* in the Spring and  *L.littorea* in the Summer `p = 0.0004`\n  annotate(\"segment\",\n           x = 0.75, xend = 2.25,\n           y = 125, yend = 125,\n           colour = \"black\") +\n  annotate(\"text\", x = 1.5,  y = 129,\n           label = \"p = 0.0004\") +\n  # *L.littorea* in the Spring *L.brevicula* in the Summer `p = 0.0172`\n  annotate(\"segment\",\n           x = 1.25, xend = 1.75,\n           y = 105, yend = 105,\n           colour = \"black\") +\n  annotate(\"text\", x = 1.5,  y = 109,\n           label = \"p = 0.0172\") +\n  theme_classic() +\n  theme(legend.position = \"inside\",\n        legend.position.inside = c(0.9, 0.1),\n        legend.background = element_rect(colour = \"black\"))\n```\n\n::: {.cell-output-display}\n![](two_way_anova_files/figure-html/unnamed-chunk-16-1.png){width=576}\n:::\n:::\n\n\n\n\n**Parasite load is greater in Summer especially for *L.brevicula*.**\nLive specimens of two species of periwinkle, *L.brevicula* and\n*L.littorea* were collected from sites in northern England in the Spring\nand Summer and gut parasite load was determined. Error bars are means\n$\\pm$ 1 standard error. Parasite load was significantly greater in\nSummer (*F* = 25.9; *d.f.* = 1, 96; *p* \\< 0.0001) but this effect\ndiffered between species (*F* = 6.2; *d.f.* = 1,96; *p* = 0.014) with a\ngreater increase in parasite load in *L.brevicula* than in *L.littorea*.\nData analysis was conducted in R [@R-core] with tidyverse packages\n[@tidyverse]. Post-hoc analysis was carried out with Tukey's Honestly\nSignificant Difference test [@tukey1949].\n:::\n\n## Summary\n\n1.  A linear model with two explanatory variable with two or more groups\n    each is also known as a **two-way ANOVA**.\n\n2.  We estimate the **coefficients** (also called the **parameters**) of\n    the model. For a two-way ANOVA with two groups in each explanatory\n    variable these are\n\n    -   the mean of the group with the first level of both explanatory\n        variables $\\beta_0$,\n    -   what needs to be added to $\\beta_0$ when one of the explanatory\n        variables goes from its first level to its second, $\\beta_1$\n    -   what needs to be added to $\\beta_0$ when the other of the\n        explanatory variables goes from its first level to its second,\n        $\\beta_2$\n    -   $\\beta_3$, the interaction effect: what additionally needs to be\n        added to $\\beta_0$ + $\\beta_1$ + $\\beta_2$ when both of the\n        explanatory variables go from their first level to their second\n\n3.  We can use `lm()` to two-way ANOVA in R.\n\n4.  In the output of `lm()` the coefficients are listed in a table in\n    the Estimates column. The *p*-value for each coefficient is in the\n    test of whether it differs from zero. At the bottom of the output\n    there is an $F$ test of the model *overall*. The R-squared value is\n    the proportion of the variance in the response variable that is\n    explained by the model.\n\n5.  To see which of the three effects are significant we can use the\n    `anova()` function on our model.\n\n6.  To find out which means differ, we need a **post-hoc** test. Here we\n    use Tukey’s HSD applied with the `emmeans()` and `pairs()` functions\n    from the **`emmeans`** package. Post-hoc tests make adjustments to\n    the *p*-values to account for the fact that we are doing multiple\n    tests.\n\n7.  The assumptions of the general linear model are that the residuals\n    are normally distributed and have homogeneity of variance. A\n    residual is the difference between the predicted value and the\n    observed value.\n\n8.  We examine a histogram of the residuals and use the Shapiro-Wilk\n    normality test to check the normality assumption. We check the\n    variance of the residuals is the same for all fitted values with a\n    residuals vs fitted plot.\n\n9.  When reporting the results of a test we give the significance,\n    direction and size of the effect. We use means and standard errors\n    for parametric tests like two-way ANOVA. We also give the test\n    statistic, the degrees of freedom (parametric) or sample size\n    (non-parametric) and the p-value. We annotate our figures with the\n    p-value, making clear which comparison it applies to.\n",
    "supporting": [
      "two_way_anova_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}